Here is the derivation of the formula, with The loan is equal to the sum of the repayments discounted to present value.