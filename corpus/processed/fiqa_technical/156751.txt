It is breaking the law, it's just difficult to demonstrate it. It's easy for international companies to make individual territories look unprofitable, reducing local tax bills. The law forbids this when abused, but not easy to prove. In this case Starbucks execs have been mouthing off about how profitable it is in the UK!