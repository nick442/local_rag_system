I would argue for another type of lottery not mentioned that still denies trades but makes it impossible for a trade to improve on satisfaction. Basically shift from school level lotteries to student level lotteries. You use a lottery to rank all students, such that the students are ranked 1 through N. Where N is the total number of students. Student number 1 gets their top choice school. Student X gets their top school that's not already filled up. This student level, instead of school level, lottery then guarantees that it's impossible for a pair of students to trade and both get a better choice than what they got from the lottery.