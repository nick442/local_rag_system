I implemented this in MatLab about 10 years back. You just calculate your conditional variance of the required assets (x_i), use matrix multiplication on the correlation matrix (rho_i_j) from the same asset (this could be a point of research but unless you are using extreme conditions on the VaR it makes little difference) then apply a standard Markiowitz optimisation approach. You can then just use simple Sharpe ratio (marginal return over conditional risk) at every point on the efficient frontier. Then choose the maximum Sharpe ratio point.