The scenarios you describe are obviously easy to catch. It is reasonably defined in tax law, but more needs to be done to exert the spirit of the rules. The problem is that when international businesses are cross charging there is limited information the tax offices have to argue the toss - for example a UK tax office cannot audit the accounts of its US parent in order to decide whether a cross charge representing license fees and marketing costs is fair - but these types of transaction are one of the primary mechanism for avoiding taxes. These are therefrom inferred by the UK companies accounts but not 'in the open' in the sense that they can be easily challenged with accurate information. And that is why it happens, people know about it, but it is still not easy to stop.